<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HARAYA ML Algorithm Explorer - Interactive Backend Demonstration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Performance polyfill for TensorFlow.js compatibility -->
    <script>
        // Polyfill for performance.now() to ensure TensorFlow.js compatibility
        if (typeof window.performance === 'undefined' || typeof window.performance.now === 'undefined') {
            window.performance = window.performance || {};
            const startTime = Date.now();
            window.performance.now = function() {
                return Date.now() - startTime;
            };
            console.warn("Polyfilled window.performance.now() for compatibility.");
        }
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700&family=Nunito+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bpi-red: #C41E3A;
            --bpi-dark-red: #8B0000;
            --bpi-light-red: #DC143C;
            --bpi-burgundy: #800020;
            --red-gray: #2D1B1B;
            --red-cream: #FFF5F5;
        }
        
        body { 
            font-family: 'Nunito Sans', sans-serif; 
            background-color: var(--red-cream);
        }
        
        .gradient-header {
            background-color: var(--bpi-red);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(196,30,58,0.15);
        }
        
        .algorithm-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            margin: 1rem 0;
            box-shadow: 0 8px 30px rgba(0,0,0,0.08);
            border-left: 4px solid var(--bpi-red);
        }
        
        
        .kmeans-canvas {
            background: linear-gradient(45deg, #f8fafc, #ffffff);
            border: 1px solid #e2e8f0;
        }
        
        .cultural-metric {
            background-color: rgba(196,30,58,0.1);
            border: 1px solid var(--bpi-red);
            border-radius: 8px;
            padding: 1rem;
        }
        
        .scam-detection-alert {
            background-color: rgba(196,30,58,0.1);
            border: 1px solid #ef4444;
            border-radius: 8px;
            padding: 1rem;
        }
        
        .loading-animation {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--sea-blue), var(--tropical-green));
            color: rgb(64, 64, 64);
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,87,166,0.3);
        }
        
        .btn-secondary {
            background: var(--flag-yellow);
            color: var(--sea-blue);
            padding: 10px 20px;
            border-radius: 6px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: #e6b800;
            transform: translateY(-1px);
        }
        
        .tab-active {
            background-color: #be0000; /* Dark gray */
            color: #fff; /* White text */
        }
        
        .tab-inactive {
            background: #e2e8f0;
            color: var(--rich-brown);
        }
        
        .progress-bar {
            background: linear-gradient(90deg, var(--tropical-green), var(--flag-yellow));
            height: 8px;
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        /* K-Means specific styles */
        .kmeans-tooltip {
            position: absolute;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px;
            border-radius: 4px;
            pointer-events: none;
            z-index: 1000;
            font-size: 12px;
            line-height: 1.3;
        }
        
        .chart-tooltip {
            position: absolute;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 10px;
            border-radius: 6px;
            pointer-events: none;
            z-index: 1000;
            font-size: 13px;
            line-height: 1.4;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        #kmeansCanvas svg {
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            background: white;
        }
        
        .data-point {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .data-point:hover {
            stroke: #333;
            stroke-width: 2;
        }
        
        .centroid {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .cluster-region {
            pointer-events: none;
        }
        
        .iteration-label {
            fill: #374151;
            font-family: 'Nunito Sans', sans-serif;
        }
        
        /* Animation styles */
        .kmeans-running {
            animation: pulse 2s infinite;
        }
        
        .metrics-card {
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }
        
        .metrics-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,87,166,0.1);
        }
        
        /* Toast Notification Styles */
        .toast {
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transform: translateX(100%);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-left: 4px solid #3B82F6;
            overflow: hidden;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast.success { border-left-color: #10B981; }
        .toast.error { border-left-color: #EF4444; }
        .toast.warning { border-left-color: #F59E0B; }
        .toast.info { border-left-color: #3B82F6; }
        
        .toast-progress {
            height: 3px;
            background: linear-gradient(90deg, var(--tropical-green), var(--flag-yellow));
            transform-origin: left;
            animation: toastProgress 4s linear;
        }
        
        @keyframes toastProgress {
            from { transform: scaleX(1); }
            to { transform: scaleX(0); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Toast Notification Container -->
    <div id="toastContainer" class="fixed top-4 right-4 z-50 space-y-2 max-w-md">
        <!-- Notifications will be dynamically added here -->
    </div>
    
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden">
        <div class="flex items-center justify-center h-full">
            <div class="bg-white rounded-lg p-8 max-w-sm mx-4 text-center">
                <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mx-auto mb-4"></div>
                <p id="loadingMessage" class="text-gray-700 font-medium">Loading...</p>
            </div>
        </div>
    </div>
    
    <!-- Header Navigation -->
    <header class="gradient-header text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                        <span class="text-2xl">üß†</span>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold">HARAYA ML Algorithm Explorer</h1>
                        <p class="text-white text-opacity-80">Interactive Backend Demonstration</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="returnToMainDemo()" class="btn-secondary">
                        ‚Üê Return to Main Demo
                    </button>
                    <div class="text-right">
                        <div class="text-sm opacity-75">Active Algorithms</div>
                        <div class="text-lg font-bold" id="activeAlgorithmsCount">0</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-6 py-8">
        
        <!-- Introduction Section -->
        <section class="algorithm-section mb-8">
            <div class="text-center">
                <h2 class="text-3xl font-bold text-gray-800 mb-4">Explore HARAYA's ML Backend</h2>
                <p class="text-lg text-gray-600 max-w-4xl mx-auto mb-6">
                    Interact with the sophisticated machine learning algorithms powering HARAYA's cultural intelligence platform. 
                    Upload your own datasets, experiment with clustering algorithms, train neural networks, and explore the 
                    cultural authenticity scoring system that makes HARAYA unique.
                </p>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-8">
                    <div class="bg-blue-50 p-4 rounded-lg text-center">
                        <div class="text-2xl mb-2">üéØ</div>
                        <div class="font-semibold text-blue-800">K-Means Clustering</div>
                        <div class="text-sm text-blue-600">Interactive persona grouping</div>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg text-center">
                        <div class="text-2xl mb-2">üß†</div>
                        <div class="font-semibold text-green-800">Neural Networks</div>
                        <div class="text-sm text-green-600">Live model training</div>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-lg text-center">
                        <div class="text-2xl mb-2">ü§ù</div>
                        <div class="font-semibold text-yellow-800">Cultural Intelligence</div>
                        <div class="text-sm text-yellow-600">Adaptive weight analysis</div>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg text-center">
                        <div class="text-2xl mb-2">üõ°Ô∏è</div>
                        <div class="font-semibold text-red-800">Scam Detection</div>
                        <div class="text-sm text-red-600">Pattern recognition</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tab Navigation -->
        <div class="flex flex-wrap justify-center space-x-2 mb-8">
            <button onclick="switchTab('data-management')" id="tab-data-management" class="px-6 py-3 rounded-lg font-semibold tab-active">
                üìä Data Management
            </button>
            <button onclick="switchTab('kmeans-clustering')" id="tab-kmeans-clustering" class="px-6 py-3 rounded-lg font-semibold tab-inactive">
                üéØ K-Means Clustering
            </button>
            <button onclick="switchTab('ml-algorithms')" id="tab-ml-algorithms" class="px-6 py-3 rounded-lg font-semibold tab-inactive">
                ü§ñ ML Algorithms
            </button>
            <button onclick="switchTab('trustworthiness-analysis')" id="tab-trustworthiness-analysis" class="px-6 py-3 rounded-lg font-semibold tab-inactive">
                üéØ Trustworthiness Analysis
            </button>
        </div>

        <!-- Data Management Section -->
        <div id="section-data-management" class="algorithm-section">
            <h3 class="text-2xl font-bold mb-6">Dataset Management & Upload</h3>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Upload Section -->
                <div>
                    <h4 class="text-lg font-semibold mb-4">Upload Custom Dataset</h4>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center">
                        <div class="text-4xl mb-4">üìÅ</div>
                        <p class="text-gray-600 mb-4">Drag & drop your CSV/JSON files here</p>
                        <input type="file" id="datasetUpload" accept=".csv,.json" class="hidden" onchange="handleDatasetUpload(event)">
                        <button onclick="document.getElementById('datasetUpload').click()" class="btn-primary">
                            Choose Files
                        </button>
                    </div>
                    
                    <div class="mt-6">
                        <h5 class="font-semibold mb-3">Pre-loaded Datasets</h5>
                        <div class="space-y-2">
                            <button onclick="loadPresetDataset('filipino-personas')" class="block w-full text-left p-3 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors">
                                <div class="font-medium">Filipino Cultural Personas (120 samples)</div>
                                <div class="text-sm text-gray-600">Trustworthy personas with authentic cultural patterns</div>
                            </button>
                            <button onclick="loadPresetDataset('scammer-patterns')" class="block w-full text-left p-3 bg-red-50 rounded-lg hover:bg-red-100 transition-colors">
                                <div class="font-medium">Scammer Behavioral Patterns (60 samples)</div>
                                <div class="text-sm text-gray-600">Untrustworthy and adversarial attack patterns</div>
                            </button>
                            <button onclick="loadPresetDataset('cultural-variations')" class="block w-full text-left p-3 bg-green-50 rounded-lg hover:bg-green-100 transition-colors">
                                <div class="font-medium">Regional Cultural Variations (300 samples)</div>
                                <div class="text-sm text-gray-600">Luzon, Visayas, Mindanao cultural patterns</div>
                            </button>
                            <button onclick="loadPresetDataset('enhanced-cultural-intelligence')" class="block w-full text-left p-3 bg-purple-50 rounded-lg hover:bg-purple-100 transition-colors border-2 border-purple-200">
                                <div class="font-medium text-purple-800">Enhanced Cultural Intelligence Dataset (2,572 samples)</div>
                                <div class="text-sm text-purple-600">Comprehensive dataset</div>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Data Preview -->
                <div>
                    <h4 class="text-lg font-semibold mb-4">Data Preview</h4>
                    
                    <!-- Data Filters -->
                    <div class="mb-4 flex flex-wrap gap-2">
                        <select id="regionFilter" onchange="filterData()" class="px-3 py-1 text-sm border rounded">
                            <option value="all">All Regions</option>
                            <option value="luzon">Luzon</option>
                            <option value="visayas">Visayas</option>
                            <option value="mindanao">Mindanao</option>
                        </select>
                        
                        <select id="trustFilter" onchange="filterData()" class="px-3 py-1 text-sm border rounded">
                            <option value="all">All Trust Levels</option>
                            <option value="trustworthy">Trustworthy</option>
                            <option value="untrustworthy">Untrustworthy</option>
                            <option value="adversarial_attack">Adversarial</option>
                            <option value="challenging_legitimate">Challenging</option>
                        </select>
                        
                        <input type="text" id="searchInput" placeholder="Search..." onkeyup="filterData()" 
                               class="px-3 py-1 text-sm border rounded flex-1 min-w-32">
                        
                        <button onclick="resetFilters()" class="px-3 py-1 text-sm bg-gray-200 text-gray-700 rounded hover:bg-gray-300">
                            Reset
                        </button>
                    </div>
                    
                    <div id="dataPreview" class="bg-gray-100 rounded-lg p-4 h-80 overflow-auto">
                        <p class="text-gray-500 text-center mt-20">No dataset loaded. Upload or select a preset dataset to preview.</p>
                    </div>
                    
                    <div class="mt-4 grid grid-cols-3 gap-4 text-center">
                        <div class="bg-white p-3 rounded-lg">
                            <div class="text-2xl font-bold text-blue-600" id="datasetRows">0</div>
                            <div class="text-sm text-gray-600">Rows</div>
                        </div>
                        <div class="bg-white p-3 rounded-lg">
                            <div class="text-2xl font-bold text-green-600" id="datasetColumns">0</div>
                            <div class="text-sm text-gray-600">Columns</div>
                        </div>
                        <div class="bg-white p-3 rounded-lg">
                            <div class="text-2xl font-bold text-yellow-600" id="datasetSize">0</div>
                            <div class="text-sm text-gray-600">KB</div>
                        </div>
                    </div>
                    
                    <div class="mt-4 flex flex-wrap gap-2 justify-center">
                        <button onclick="exportDataset('json')" class="btn-secondary text-sm">
                            Export JSON
                        </button>
                        <button onclick="exportDataset('csv')" class="btn-secondary text-sm">
                            Export CSV
                        </button>
                        <button onclick="exportDataset('report')" class="btn-secondary text-sm">
                            Export Report
                        </button>
                    </div>
                    
                    <!-- ML Ready Status -->
                    <div id="mlReadyStatus" class="mt-4 p-3 bg-gradient-to-r from-green-50 to-blue-50 border-l-4 border-green-500 rounded-lg hidden">
                        <div class="flex items-center space-x-2">
                            <span class="text-green-600">‚úÖ</span>
                            <div>
                                <div class="font-semibold text-green-800">Dataset Ready for ML Algorithms</div>
                                <div class="text-sm text-green-700">
                                    <span id="readyRecordCount">0</span> records loaded and available for 
                                    <a href="#" onclick="switchTab('kmeans-clustering')" class="text-blue-600 hover:text-blue-800 underline">K-Means Clustering</a>, 
 
                                    and other algorithms.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Analytics -->
                    <div class="mt-6">
                        <h5 class="font-semibold mb-3">Quick Analytics</h5>
                        <div id="quickAnalytics" class="grid grid-cols-2 gap-2 text-sm">
                            <div class="bg-blue-50 p-2 rounded text-center">
                                <div class="font-bold text-blue-600" id="avgAge">--</div>
                                <div class="text-blue-800">Avg Age</div>
                            </div>
                            <div class="bg-green-50 p-2 rounded text-center">
                                <div class="font-bold text-green-600" id="avgIncome">--</div>
                                <div class="text-green-800">Avg Income</div>
                            </div>
                            <div class="bg-yellow-50 p-2 rounded text-center">
                                <div class="font-bold text-yellow-600" id="trustworthyPercent">--</div>
                                <div class="text-yellow-800">% Trustworthy</div>
                            </div>
                            <div class="bg-purple-50 p-2 rounded text-center">
                                <div class="font-bold text-purple-600" id="avgDigitalLiteracy">--</div>
                                <div class="text-purple-800">Avg Digital Lit.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- K-Means Clustering Section -->
        <div id="section-kmeans-clustering" class="algorithm-section hidden">
            <h3 class="text-2xl font-bold mb-6">Interactive K-Means Clustering</h3>
            
            <!-- Dataset Status and Selector -->
            <div class="bg-gradient-to-r from-blue-50 to-green-50 p-4 rounded-lg border border-blue-200 mb-6">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center space-x-3">
                        <div class="w-3 h-3 bg-gray-400 rounded-full" id="datasetStatusIndicator"></div>
                        <h4 class="text-lg font-semibold">üìä Dataset Connection</h4>
                    </div>
                    <button onclick="refreshDatasetConnection()" class="text-sm text-blue-600 hover:text-blue-800">
                        üîÑ Refresh
                    </button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Available Dataset</label>
                        <select id="kmeansDatasetSelector" class="w-full p-2 text-sm border rounded-lg bg-white" onchange="selectKmeansDataset()">
                            <option value="">No dataset loaded</option>
                        </select>
                    </div>
                    <div>
                        <div class="text-sm font-medium text-gray-700 mb-1">Records Available</div>
                        <div class="text-lg font-bold text-blue-600" id="kmeansDatasetRecords">--</div>
                    </div>
                    <div>
                        <div class="text-sm font-medium text-gray-700 mb-1">Data Source</div>
                        <div class="text-sm text-gray-600" id="kmeansDatasetSource">--</div>
                    </div>
                </div>
                
                <!-- Feature Mapping Info -->
                <div id="featureMappingInfo" class="mt-4 p-3 bg-white rounded-lg border border-gray-200 hidden">
                    <div class="flex items-center justify-between mb-3">
                        <h5 class="font-semibold text-sm">üìã Feature Mapping & Data Quality</h5>
                        <button onclick="toggleDetailedMapping()" class="text-xs text-blue-600 hover:text-blue-800">
                            Show Details
                        </button>
                    </div>
                    
                    <!-- Basic Mapping View -->
                    <div id="basicMappingView" class="grid grid-cols-1 md:grid-cols-3 gap-3 text-xs">
                        <div class="bg-blue-50 p-2 rounded border">
                            <div class="font-semibold text-blue-800">Community Standing Score</div>
                            <div class="text-blue-600">‚Üì Maps to Kapwa Score</div>
                            <div id="kapwaDataQuality" class="text-green-600 text-xs">‚úì Available</div>
                        </div>
                        <div class="bg-green-50 p-2 rounded border">
                            <div class="font-semibold text-green-800">Location Stability Score</div>
                            <div class="text-green-600">‚Üì Maps to Bayanihan</div>
                            <div id="bayanihanDataQuality" class="text-green-600 text-xs">‚úì Available</div>
                        </div>
                        <div class="bg-yellow-50 p-2 rounded border">
                            <div class="font-semibold text-yellow-800">Bill Payment Consistency</div>
                            <div class="text-yellow-600">‚Üì Maps to Utang na Loob</div>
                            <div id="utangDataQuality" class="text-green-600 text-xs">‚úì Available</div>
                        </div>
                    </div>
                    
                    <!-- Detailed Mapping View -->
                    <div id="detailedMappingView" class="hidden mt-4">
                        <div class="bg-gray-50 p-3 rounded text-xs">
                            <h6 class="font-semibold mb-2">Data Transformation Process:</h6>
                            <div class="space-y-1 text-gray-700">
                                <div>1. <code>community_standing_score</code> (0-1) ‚Üí Cultural Kapwa strength</div>
                                <div>2. <code>location_stability_score</code> (0-1) ‚Üí Bayanihan participation level</div>
                                <div>3. <code>bill_payment_consistency</code> (0-1) ‚Üí Utang na Loob integrity</div>
                                <div>4. Values are normalized to 0-1 range for optimal clustering</div>
                            </div>
                            <div class="mt-2 pt-2 border-t">
                                <div class="font-semibold">Data Completeness:</div>
                                <div id="dataCompletenessInfo" class="text-gray-600">Loading...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Controls -->
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Number of Clusters (K)</label>
                        <input type="range" id="kmeansK" min="2" max="8" value="3" class="w-full" oninput="updateKMeansVisualization()">
                        <div class="flex justify-between text-xs text-gray-500">
                            <span>2</span>
                            <span id="kmeansKValue">3</span>
                            <span>8</span>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Clustering Features</label>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" checked class="mr-2" value="kapwa_score">
                                Kapwa Network Strength
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" checked class="mr-2" value="bayanihan_participation">
                                Bayanihan Participation
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" checked class="mr-2" value="utang_na_loob_integrity">
                                Utang na Loob Integrity
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2" value="income">
                                Monthly Income
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2" value="digital_engagement">
                                Digital Engagement
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2" value="regional_authenticity">
                                Regional Authenticity
                            </label>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Animation Speed</label>
                        <input type="range" id="animationSpeed" min="100" max="2000" value="500" class="w-full">
                        <div class="flex justify-between text-xs text-gray-500">
                            <span>Fast</span>
                            <span>Medium</span>
                            <span>Slow</span>
                        </div>
                    </div>
                    
                    <div class="space-y-2">
                        <button onclick="runKMeansClustering()" class="btn-primary w-full">
                            üöÄ Run Clustering Algorithm
                        </button>
                        <div class="grid grid-cols-3 gap-2">
                            <button onclick="recommendOptimalK()" class="btn-secondary text-sm">
                                üìä Find K
                            </button>
                            <button onclick="loadDemoData()" class="btn-secondary text-sm">
                                üéØ Generate Demo Data
                            </button>
                            <button onclick="resetKMeansClustering()" class="btn-secondary text-sm">
                                üîÑ Reset
                            </button>
                        </div>
                    </div>
                    
                    <div id="kmeansResults" class="bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg border">
                        <h5 class="font-semibold mb-2">üîç Algorithm Status</h5>
                        <div id="kmeansStatus" class="text-sm mb-2">Ready to run clustering</div>
                        <div id="kmeansMetrics" class="mt-3 space-y-2 hidden">
                            <div class="flex justify-between items-center">
                                <span class="text-xs font-medium">Iterations:</span>
                                <span id="kmeansIterations" class="text-sm font-bold">0</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-xs font-medium">Convergence:</span>
                                <span id="kmeansConvergence" class="text-sm font-bold">0%</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-xs font-medium">WCSS:</span>
                                <span id="kmeansWCSS" class="text-sm font-bold">--</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-xs font-medium">Silhouette Score:</span>
                                <span id="kmeansSilhouette" class="text-sm font-bold">--</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Visualization -->
                <div class="lg:col-span-2">
                    <div class="bg-white p-4 rounded-lg border shadow-sm">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-semibold">üìà Clustering Visualization</h4>
                            <div class="text-sm text-gray-500">Interactive scatter plot</div>
                        </div>
                        <div id="kmeansCanvas" class="w-full border rounded" style="height: 400px; min-height: 400px;"></div>
                        <div class="mt-2 text-xs text-gray-500 text-center">
                            Hover over points for details ‚Ä¢ Centroids shown as larger circles with black borders
                        </div>
                    </div>
                    
                    <div class="mt-4 grid grid-cols-2 gap-4">
                        <div class="bg-white p-4 rounded-lg border shadow-sm">
                            <h6 class="font-semibold mb-2">üìä Cluster Distribution</h6>
                            <div id="clusterDistributionChart" class="w-full" style="height: 150px;"></div>
                            <div class="mt-2 text-xs text-gray-500 text-center">
                                Hover for cluster details
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded-lg border shadow-sm">
                            <h6 class="font-semibold mb-2">üèõÔ∏è Cultural Insights</h6>
                            <div id="culturalInsights" class="text-sm text-gray-600 max-h-32 overflow-y-auto">
                                Run clustering to see cultural pattern insights
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Advanced ML Algorithms Section -->
        <div id="section-ml-algorithms" class="algorithm-section hidden">
            <h3 class="text-2xl font-bold mb-6">ü§ñ Advanced ML Algorithms Dashboard</h3>
            
            <!-- Dataset Connection Status -->
            <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg border border-blue-200 mb-6">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center space-x-3">
                        <div class="w-3 h-3 bg-gray-400 rounded-full" id="mlDatasetStatusIndicator"></div>
                        <h4 class="text-lg font-semibold">üìä Dataset Connection</h4>
                    </div>
                    <button onclick="refreshMLDatasetConnection()" class="text-sm text-blue-600 hover:text-blue-800">
                        üîÑ Refresh
                    </button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Available Dataset</label>
                        <select id="mlDatasetSelector" class="w-full p-2 text-sm border rounded-lg bg-white" onchange="selectMLDataset()">
                            <option value="">No dataset loaded</option>
                        </select>
                    </div>
                    <div>
                        <div class="text-sm font-medium text-gray-700 mb-1">Training Records</div>
                        <div class="text-lg font-bold text-purple-600" id="mlDatasetRecords">--</div>
                    </div>
                    <div>
                        <div class="text-sm font-medium text-gray-700 mb-1">Label Distribution</div>
                        <div class="text-sm text-gray-600" id="mlLabelDistribution">--</div>
                    </div>
                </div>
            </div>

            <!-- Train-Val-Test Split Visualization Dashboard -->
            <div class="bg-gradient-to-r from-yellow-50 to-orange-50 p-6 rounded-lg border border-yellow-200 mb-6">
                <div class="flex items-center justify-between mb-4">
                    <h4 class="text-lg font-bold text-orange-800">üìä Data Split Visualization</h4>
                    <div class="flex items-center space-x-2">
                        <span class="text-xs text-orange-600">70% Train</span>
                        <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                        <span class="text-xs text-orange-600">20% Val</span>
                        <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                        <span class="text-xs text-orange-600">10% Test</span>
                        <span class="w-2 h-2 bg-red-500 rounded-full"></span>
                    </div>
                </div>

                <!-- Split Statistics Table -->
                <div class="overflow-x-auto mb-4">
                    <table class="w-full text-sm border border-orange-200 rounded-lg">
                        <thead class="bg-orange-100">
                            <tr>
                                <th class="text-left py-2 px-3 font-semibold">Algorithm</th>
                                <th class="text-center py-2 px-3 font-semibold">Train Size</th>
                                <th class="text-center py-2 px-3 font-semibold">Val Size</th>
                                <th class="text-center py-2 px-3 font-semibold">Test Size</th>
                                <th class="text-center py-2 px-3 font-semibold">Split Type</th>
                                <th class="text-center py-2 px-3 font-semibold">Last Updated</th>
                            </tr>
                        </thead>
                        <tbody id="splitVisualizationTable" class="bg-white">
                            <tr>
                                <td class="py-2 px-3 border-b">üìä Linear Regression</td>
                                <td class="text-center py-2 px-3 border-b" id="lr-train-size">--</td>
                                <td class="text-center py-2 px-3 border-b" id="lr-val-size">--</td>
                                <td class="text-center py-2 px-3 border-b" id="lr-test-size">--</td>
                                <td class="text-center py-2 px-3 border-b" id="lr-split-type">70-20-10</td>
                                <td class="text-center py-2 px-3 border-b text-xs text-gray-500" id="lr-split-time">Not run</td>
                            </tr>
                            <tr>
                                <td class="py-2 px-3 border-b">üéØ Support Vector Regression</td>
                                <td class="text-center py-2 px-3 border-b" id="svr-train-size">--</td>
                                <td class="text-center py-2 px-3 border-b" id="svr-val-size">--</td>
                                <td class="text-center py-2 px-3 border-b" id="svr-test-size">--</td>
                                <td class="text-center py-2 px-3 border-b" id="svr-split-type">70-20-10</td>
                                <td class="text-center py-2 px-3 border-b text-xs text-gray-500" id="svr-split-time">Not run</td>
                            </tr>
                            <tr>
                                <td class="py-2 px-3 border-b">üå≤ Random Forest</td>
                                <td class="text-center py-2 px-3 border-b" id="rf-train-size">--</td>
                                <td class="text-center py-2 px-3 border-b" id="rf-val-size">--</td>
                                <td class="text-center py-2 px-3 border-b" id="rf-test-size">--</td>
                                <td class="text-center py-2 px-3 border-b" id="rf-split-type">70-20-10</td>
                                <td class="text-center py-2 px-3 border-b text-xs text-gray-500" id="rf-split-time">Not run</td>
                            </tr>
                            <tr>
                                <td class="py-2 px-3 border-b">üé≠ Advanced Ensemble</td>
                                <td class="text-center py-2 px-3 border-b" id="ensemble-train-size">--</td>
                                <td class="text-center py-2 px-3 border-b" id="ensemble-val-size">--</td>
                                <td class="text-center py-2 px-3 border-b" id="ensemble-test-size">--</td>
                                <td class="text-center py-2 px-3 border-b" id="ensemble-split-type">70-20-10</td>
                                <td class="text-center py-2 px-3 border-b text-xs text-gray-500" id="ensemble-split-time">Not run</td>
                            </tr>
                            <tr class="bg-gray-50">
                                <td class="py-2 px-3 border-b">üîó Semi-Supervised Learning</td>
                                <td class="text-center py-2 px-3 border-b text-gray-500" id="ssl-train-size">N/A</td>
                                <td class="text-center py-2 px-3 border-b text-gray-500" id="ssl-val-size">N/A</td>
                                <td class="text-center py-2 px-3 border-b text-gray-500" id="ssl-test-size">N/A</td>
                                <td class="text-center py-2 px-3 border-b text-xs text-gray-600" id="ssl-split-type">20% Labeled</td>
                                <td class="text-center py-2 px-3 border-b text-xs text-gray-500" id="ssl-split-time">Algorithm specific</td>
                            </tr>
                            <tr class="bg-gray-50">
                                <td class="py-2 px-3 border-b">üß† Self-Supervised Learning</td>
                                <td class="text-center py-2 px-3 border-b text-gray-500" id="ssae-train-size">N/A</td>
                                <td class="text-center py-2 px-3 border-b text-gray-500" id="ssae-val-size">N/A</td>
                                <td class="text-center py-2 px-3 border-b text-gray-500" id="ssae-test-size">N/A</td>
                                <td class="text-center py-2 px-3 border-b text-xs text-gray-600" id="ssae-split-type">Unsupervised</td>
                                <td class="text-center py-2 px-3 border-b text-xs text-gray-500" id="ssae-split-time">No splitting</td>
                            </tr>
                            <tr class="bg-gray-50">
                                <td class="py-2 px-3">üéØ Reinforcement Learning</td>
                                <td class="text-center py-2 px-3 text-gray-500" id="rl-train-size">N/A</td>
                                <td class="text-center py-2 px-3 text-gray-500" id="rl-val-size">N/A</td>
                                <td class="text-center py-2 px-3 text-gray-500" id="rl-test-size">N/A</td>
                                <td class="text-center py-2 px-3 text-xs text-gray-600" id="rl-split-type">Episodes</td>
                                <td class="text-center py-2 px-3 text-xs text-gray-500" id="rl-split-time">Environment based</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Split Configuration Controls -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-orange-700 mb-1">Train Ratio (%)</label>
                        <input type="range" id="trainRatioSlider" min="50" max="80" value="70" step="5" class="w-full" 
                               oninput="updateSplitPreview()">
                        <div class="text-xs text-center mt-1">
                            <span id="trainRatioValue">70%</span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-orange-700 mb-1">Validation Ratio (%)</label>
                        <input type="range" id="valRatioSlider" min="10" max="30" value="20" step="5" class="w-full"
                               oninput="updateSplitPreview()">
                        <div class="text-xs text-center mt-1">
                            <span id="valRatioValue">20%</span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-orange-700 mb-1">Test Ratio (%)</label>
                        <div class="w-full p-2 text-sm border rounded-lg bg-gray-100 text-center">
                            <span id="testRatioValue">10%</span> (Auto)
                        </div>
                        <div class="text-xs text-center mt-1 text-gray-600">
                            Automatically calculated
                        </div>
                    </div>
                </div>
            </div>

            <!-- Algorithm Categories -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <!-- ML Algorithms Algorithms -->
                <div class="bg-gradient-to-br from-green-50 to-blue-50 p-6 rounded-lg border border-green-200">
                    <h4 class="text-lg font-bold text-green-800 mb-4"> ML Algorithms </h4>
                    
                    <!-- Semi-Supervised Learning -->
                    <div class="mb-4">
                        <div class="flex items-center justify-between mb-2">
                            <h5 class="font-semibold text-sm">Semi-Supervised Learning</h5>
                            <span class="text-xs text-gray-600">Label Propagation</span>
                        </div>
                        
                        <!-- SSL Epoch Configuration -->
                        <div class="mb-3 p-2 bg-white rounded border">
                            <label class="block text-xs font-medium text-gray-700 mb-1">Max Iterations: <span id="sslIterationsValue">1000</span></label>
                            <input type="range" id="sslIterationsSlider" min="50" max="2000" value="1000" step="50" class="w-full text-xs"
                                   oninput="document.getElementById('sslIterationsValue').textContent = this.value">
                        </div>
                        
                        <button onclick="trainSemiSupervisedLearning()" class="btn-primary w-full mb-2 text-sm py-2">
                            üîó Train SSL Model
                        </button>
                        <div class="text-xs text-gray-600">Uses limited labeled data to learn from unlabeled cultural patterns</div>
                    </div>

                    <!-- Self-Supervised Learning -->
                    <div class="mb-4">
                        <div class="flex items-center justify-between mb-2">
                            <h5 class="font-semibold text-sm">Self-Supervised Learning</h5>
                            <span class="text-xs text-gray-600">Autoencoder</span>
                        </div>
                        
                        <!-- Autoencoder Epoch Configuration -->
                        <div class="mb-3 p-2 bg-white rounded border">
                            <label class="block text-xs font-medium text-gray-700 mb-1">Training Epochs: <span id="autoencoderEpochsValue">200</span></label>
                            <input type="range" id="autoencoderEpochsSlider" min="25" max="500" value="200" step="25" class="w-full text-xs"
                                   oninput="document.getElementById('autoencoderEpochsValue').textContent = this.value">
                        </div>
                        
                        <button onclick="trainSelfSupervisedLearning()" class="btn-primary w-full mb-2 text-sm py-2">
                            üß† Train Autoencoder
                        </button>
                        <div class="text-xs text-gray-600">Discovers hidden cultural patterns without labels</div>
                    </div>
                </div>

                <!-- ML Algorithms 2 -->
                <div class="bg-gradient-to-br from-red-50 to-orange-50 p-6 rounded-lg border border-red-200">
                    <h4 class="text-lg font-bold text-red-800 mb-4">ML Algorithms</h4>
                    
                    <!-- Reinforcement Learning -->
                    <div class="mb-4">
                        <div class="flex items-center justify-between mb-2">
                            <h5 class="font-semibold text-sm">Reinforcement Learning</h5>
                            <span class="text-xs text-gray-600">Q-Learning</span>
                        </div>
                        
                        <!-- RL Episodes Configuration -->
                        <div class="mb-3 p-2 bg-white rounded border">
                            <label class="block text-xs font-medium text-gray-700 mb-1">Training Episodes: <span id="rlEpisodesValue">800</span></label>
                            <input type="range" id="rlEpisodesSlider" min="100" max="1000" value="800" step="50" class="w-full text-xs"
                                   oninput="document.getElementById('rlEpisodesValue').textContent = this.value">
                        </div>
                        
                        <button onclick="trainReinforcementLearning()" class="btn-primary w-full mb-2 text-sm py-2">
                            üéØ Train RL Agent
                        </button>
                        <div class="text-xs text-gray-600">Learns optimal scam detection through reward-based feedback</div>
                    </div>

                    <!-- Advanced Ensemble -->
                    <div class="mb-4">
                        <div class="flex items-center justify-between mb-2">
                            <h5 class="font-semibold text-sm">Advanced Ensemble</h5>
                            <span class="text-xs text-gray-600">Voting + Bagging</span>
                        </div>
                        
                        <!-- Ensemble Epochs Configuration -->
                        <div class="mb-3 p-2 bg-white rounded border">
                            <label class="block text-xs font-medium text-gray-700 mb-1">Base Model Epochs: <span id="ensembleEpochsValue">100</span></label>
                            <input type="range" id="ensembleEpochsSlider" min="10" max="200" value="100" step="10" class="w-full text-xs"
                                   oninput="document.getElementById('ensembleEpochsValue').textContent = this.value">
                        </div>
                        
                        <button onclick="trainAdvancedEnsemble()" class="btn-primary w-full mb-2 text-sm py-2">
                            üé≠ Train Ensemble
                        </button>
                        <div class="text-xs text-gray-600">Combines multiple algorithms for robust predictions</div>
                    </div>
                </div>
            </div>

            <!-- Traditional ML Algorithms -->
            <div class="bg-gradient-to-r from-gray-50 to-blue-50 p-6 rounded-lg border border-gray-200 mb-8">
                <h4 class="text-lg font-bold text-gray-800 mb-4">üìà Traditional ML Algorithms</h4>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Linear Regression -->
                    <div>
                        <h5 class="font-semibold text-sm mb-2">Linear Regression</h5>
                        
                        <!-- LR Epoch Configuration -->
                        <div class="mb-2 p-2 bg-white rounded border text-xs">
                            <label class="block font-medium text-gray-700 mb-1">Epochs: <span id="lrEpochsValue">100</span></label>
                            <input type="range" id="lrEpochsSlider" min="10" max="1000" value="100" step="10" class="w-full"
                                   oninput="document.getElementById('lrEpochsValue').textContent = this.value">
                        </div>
                        
                        <button onclick="trainLinearRegression()" class="btn-primary w-full mb-2 text-sm py-2">
                            üìä Train Model
                        </button>
                        <div class="text-xs text-gray-600">Baseline regression algorithm</div>
                        <div id="linearRegressionResults" class="mt-2 p-2 bg-gray-100 rounded text-xs"></div>
                    </div>
                    
                    <!-- Support Vector Regression -->
                    <div>
                        <h5 class="font-semibold text-sm mb-2">Support Vector Regression</h5>
                        
                        <!-- SVR Iterations Configuration -->
                        <div class="mb-2 p-2 bg-white rounded border text-xs">
                            <label class="block font-medium text-gray-700 mb-1">Max Iter: <span id="svrIterationsValue">1000</span></label>
                            <input type="range" id="svrIterationsSlider" min="100" max="2000" value="1000" step="100" class="w-full"
                                   oninput="document.getElementById('svrIterationsValue').textContent = this.value">
                        </div>
                        
                        <button onclick="trainSupportVectorRegression()" class="btn-primary w-full mb-2 text-sm py-2">
                            üéØ Train Model
                        </button>
                        <div class="text-xs text-gray-600">Non-linear regression with RBF kernel</div>
                        <div id="svrResults" class="mt-2 p-2 bg-gray-100 rounded text-xs"></div>
                    </div>
                    
                    <!-- Random Forest -->
                    <div>
                        <h5 class="font-semibold text-sm mb-2">Random Forest</h5>
                        
                        <!-- RF Trees Configuration -->
                        <div class="mb-2 p-2 bg-white rounded border text-xs">
                            <label class="block font-medium text-gray-700 mb-1">Trees: <span id="rfTreesValue">50</span></label>
                            <input type="range" id="rfTreesSlider" min="10" max="200" value="50" step="10" class="w-full"
                                   oninput="document.getElementById('rfTreesValue').textContent = this.value">
                        </div>
                        
                        <button onclick="trainRandomForestRegression()" class="btn-primary w-full mb-2 text-sm py-2">
                            üå≤ Train Model
                        </button>
                        <div class="text-xs text-gray-600">Ensemble of decision trees</div>
                        <div id="rfResults" class="mt-2 p-2 bg-gray-100 rounded text-xs"></div>
                    </div>
                </div>
            </div>

            <!-- Model Performance Comparison -->
            <div class="bg-white p-6 rounded-lg border border-gray-200 mb-6">
                <h4 class="text-lg font-bold mb-4">üìä Model Performance Comparison</h4>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b">
                                <th class="text-left py-2">Algorithm</th>
                                <th class="text-center py-2">R-Squared (%)</th>
                                <th class="text-center py-2">MSE</th>
                                <th class="text-center py-2">MAE</th>
                                <th class="text-center py-2">Training Time</th>
                                <th class="text-center py-2">Status</th>
                            </tr>
                        </thead>
                        <tbody id="modelComparisonTable">
                            <tr>
                                <td class="py-2">üìä Linear Regression</td>
                                <td class="text-center py-2" id="lr-rsquared">--</td>
                                <td class="text-center py-2" id="lr-mse">--</td>
                                <td class="text-center py-2" id="lr-mae">--</td>
                                <td class="text-center py-2" id="lr-time">--</td>
                                <td class="text-center py-2" id="lr-status">‚è≥ Ready</td>
                            </tr>
                            <tr>
                                <td class="py-2">üéØ Support Vector Regression</td>
                                <td class="text-center py-2" id="svr-rsquared">--</td>
                                <td class="text-center py-2" id="svr-mse">--</td>
                                <td class="text-center py-2" id="svr-mae">--</td>
                                <td class="text-center py-2" id="svr-time">--</td>
                                <td class="text-center py-2" id="svr-status">‚è≥ Ready</td>
                            </tr>
                            <tr>
                                <td class="py-2">üå≤ Random Forest</td>
                                <td class="text-center py-2" id="rf-rsquared">--</td>
                                <td class="text-center py-2" id="rf-mse">--</td>
                                <td class="text-center py-2" id="rf-mae">--</td>
                                <td class="text-center py-2" id="rf-time">--</td>
                                <td class="text-center py-2" id="rf-status">‚è≥ Ready</td>
                            </tr>
                            <tr>
                                <td class="py-2">üîó Semi-Supervised Learning</td>
                                <td class="text-center py-2" id="ssl-rsquared">--</td>
                                <td class="text-center py-2" id="ssl-mse">--</td>
                                <td class="text-center py-2" id="ssl-mae">--</td>
                                <td class="text-center py-2" id="ssl-time">--</td>
                                <td class="text-center py-2" id="ssl-status">‚è≥ Ready</td>
                            </tr>
                            <tr>
                                <td class="py-2">üß† Self-Supervised Learning</td>
                                <td class="text-center py-2" id="ssae-rsquared">--</td>
                                <td class="text-center py-2" id="ssae-mse">--</td>
                                <td class="text-center py-2" id="ssae-mae">--</td>
                                <td class="text-center py-2" id="ssae-time">--</td>
                                <td class="text-center py-2" id="ssae-status">‚è≥ Ready</td>
                            </tr>
                            <tr>
                                <td class="py-2">üéØ Reinforcement Learning</td>
                                <td class="text-center py-2" id="rl-rsquared">--</td>
                                <td class="text-center py-2" id="rl-mse">--</td>
                                <td class="text-center py-2" id="rl-mae">--</td>
                                <td class="text-center py-2" id="rl-time">--</td>
                                <td class="text-center py-2" id="rl-status">‚è≥ Ready</td>
                            </tr>
                            <tr>
                                <td class="py-2">üé≠ Advanced Ensemble</td>
                                <td class="text-center py-2" id="ensemble-rsquared">--</td>
                                <td class="text-center py-2" id="ensemble-mse">--</td>
                                <td class="text-center py-2" id="ensemble-mae">--</td>
                                <td class="text-center py-2" id="ensemble-time">--</td>
                                <td class="text-center py-2" id="ensemble-status">‚è≥ Ready</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Batch Training -->
            <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-lg border border-purple-200 mb-6">
                <h4 class="text-lg font-bold text-purple-800 mb-4">üöÄ Batch Training</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <button onclick="trainAllAdvancedModels()" class="btn-primary w-full mb-3">
                            üöÄ Train All Advanced Models
                        </button>
                        <div class="text-sm text-gray-600">Trains all advanced ML models and compares performance</div>
                    </div>
                    <div>
                        <button onclick="trainAllTraditionalModels()" class="btn-primary w-full mb-3">
                            üìä Train Traditional Models Only
                        </button>
                        <div class="text-sm text-gray-600">Trains only Linear Regression, SVR, and Random Forest</div>
                    </div>
                </div>
            </div>

            <!-- Debug Console -->
            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                <h4 class="text-lg font-semibold mb-3">üîç Training Debug Console</h4>
                <div id="mlDebugConsole" class="bg-black text-green-400 p-4 rounded font-mono text-xs h-64 overflow-y-auto">
                    <div>ü§ñ Advanced ML Algorithms Debug Console Ready</div>
                    <div>üìä Load a dataset and start training models...</div>
                </div>
                <div class="mt-2 flex space-x-2">
                    <button onclick="clearMLDebugConsole()" class="text-xs bg-gray-600 text-white px-3 py-1 rounded">
                        Clear Console
                    </button>
                    <button onclick="exportMLDebugLog()" class="text-xs bg-blue-600 text-white px-3 py-1 rounded">
                        Export Debug Log
                    </button>
                </div>
            </div>
        </div>

        <!-- Trustworthiness Analysis Section -->
        <div id="section-trustworthiness-analysis" class="algorithm-section hidden">
            <h3 class="text-2xl font-bold mb-6">üéØ BPI Laniakea Trustworthiness Analysis</h3>
            <p class="text-gray-600 mb-8">Comprehensive analysis combining cultural intelligence and fraud risk assessment to generate trustworthiness predictions for BPI microfinance decisions.</p>
            
            <!-- Overall Trustworthiness Score -->
            <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-8 rounded-xl mb-8 text-center">
                <h4 class="text-lg font-semibold mb-4">Overall Trustworthiness Score</h4>
                <div class="score-display">
                    <div class="text-6xl font-bold text-blue-600 mb-2" id="overallTrustworthinessScore">87%</div>
                    <p class="text-xl font-medium text-gray-700" id="trustworthinessLabel">Highly Trustworthy</p>
                </div>
                <p class="text-gray-600 mt-4">Based on comprehensive cultural intelligence and behavioral risk analysis</p>
            </div>

            <!-- Test Persona Input -->
            <div class="bg-white p-6 rounded-xl mb-8">
                <h4 class="text-lg font-semibold mb-4">Test Persona Analysis</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Monthly Income</label>
                        <input type="number" id="trustTestIncome" value="25000" class="w-full p-2 border rounded" oninput="analyzeTrustworthiness()">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Community Standing (0-1)</label>
                        <input type="range" id="trustTestCommunityStanding" min="0" max="1" step="0.01" value="0.85" class="w-full" oninput="analyzeTrustworthiness()">
                        <div class="text-xs text-gray-500 text-center" id="trustCommunityStandingValue">0.85</div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Digital Activity Level</label>
                        <input type="range" id="trustTestDigitalActivity" min="1" max="10" value="6" class="w-full" oninput="analyzeTrustworthiness()">
                        <div class="text-xs text-gray-500 text-center" id="trustDigitalActivityValue">6</div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Regional Context</label>
                        <select id="trustTestRegion" class="w-full p-2 border rounded" onchange="analyzeTrustworthiness()">
                            <option value="metro_manila">Metro Manila</option>
                            <option value="luzon_rural">Luzon Rural</option>
                            <option value="visayas_urban">Visayas Urban</option>
                            <option value="mindanao_rural">Mindanao Rural</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Bill Payment Consistency (0-1)</label>
                        <input type="range" id="trustTestBillConsistency" min="0" max="1" step="0.01" value="0.89" class="w-full" oninput="analyzeTrustworthiness()">
                        <div class="text-xs text-gray-500 text-center" id="trustBillConsistencyValue">0.89</div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Location Stability (0-1)</label>
                        <input type="range" id="trustTestLocationStability" min="0" max="1" step="0.01" value="0.78" class="w-full" oninput="analyzeTrustworthiness()">
                        <div class="text-xs text-gray-500 text-center" id="trustLocationStabilityValue">0.78</div>
                    </div>
                </div>
                
                <div class="mt-6 flex flex-wrap gap-3 justify-center">
                    <button onclick="generateTrustworthyPersona()" class="btn-primary">
                        Generate High Trust Profile
                    </button>
                    <button onclick="generateMediumTrustPersona()" class="btn-secondary">
                        Generate Medium Trust Profile
                    </button>
                    <button onclick="generateRiskyPersona()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700">
                        Generate Risk Profile
                    </button>
                    <button onclick="generateRandomPersona()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">
                        Generate Random Profile
                    </button>
                </div>
            </div>
            
            <!-- Detailed Breakdowns -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <!-- Cultural Intelligence Breakdown -->
                <div class="bg-white p-6 rounded-xl">
                    <h4 class="text-lg font-semibold mb-4 text-purple-600">ü§ù Cultural Intelligence Analysis</h4>
                    <div class="space-y-4">
                        <div class="breakdown-item">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-medium">Kapwa Score (Shared Identity)</span>
                                <span id="trustKapwaScore" class="font-bold text-purple-600">92%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div class="bg-purple-600 h-3 rounded-full transition-all duration-500" id="trustKapwaProgress" style="width: 92%"></div>
                            </div>
                        </div>
                        <div class="breakdown-item">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-medium">Bayanihan Participation</span>
                                <span id="trustBayanihanScore" class="font-bold text-purple-600">89%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div class="bg-purple-600 h-3 rounded-full transition-all duration-500" id="trustBayanihanProgress" style="width: 89%"></div>
                            </div>
                        </div>
                        <div class="breakdown-item">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-medium">Utang na Loob Integrity</span>
                                <span id="trustUtangScore" class="font-bold text-purple-600">93%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div class="bg-purple-600 h-3 rounded-full transition-all duration-500" id="trustUtangProgress" style="width: 93%"></div>
                            </div>
                        </div>
                        <div class="breakdown-item">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-medium">Regional Authenticity</span>
                                <span id="trustRegionalScore" class="font-bold text-purple-600">85%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div class="bg-purple-600 h-3 rounded-full transition-all duration-500" id="trustRegionalProgress" style="width: 85%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 p-3 bg-purple-50 rounded-lg">
                        <p class="text-sm text-purple-700" id="culturalInsights">
                            Strong alignment with Filipino cultural values. Authentic community connections and high gratitude patterns indicate genuine cultural integration.
                        </p>
                    </div>
                </div>

                <!-- Fraud Risk Assessment -->
                <div class="bg-white p-6 rounded-xl">
                    <h4 class="text-lg font-semibold mb-4 text-red-600">üõ°Ô∏è Fraud Risk Assessment</h4>
                    <div class="space-y-4">
                        <div class="breakdown-item">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-medium">Behavioral Consistency</span>
                                <span id="trustBehaviorScore" class="font-bold text-green-600">Low Risk (15%)</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div class="bg-red-600 h-3 rounded-full transition-all duration-500" id="trustBehaviorProgress" style="width: 15%"></div>
                            </div>
                        </div>
                        <div class="breakdown-item">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-medium">Profile Consistency</span>
                                <span id="trustProfileScore" class="font-bold text-green-600">Very Low Risk (8%)</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div class="bg-red-600 h-3 rounded-full transition-all duration-500" id="trustProfileProgress" style="width: 8%"></div>
                            </div>
                        </div>
                        <div class="breakdown-item">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-medium">Transaction Velocity Risk</span>
                                <span id="trustVelocityScore" class="font-bold text-green-600">Low Risk (12%)</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div class="bg-red-600 h-3 rounded-full transition-all duration-500" id="trustVelocityProgress" style="width: 12%"></div>
                            </div>
                        </div>
                        <div class="breakdown-item">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-medium">Cultural Mimicry Detection</span>
                                <span id="trustMimicryScore" class="font-bold text-green-600">No Risk (3%)</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div class="bg-red-600 h-3 rounded-full transition-all duration-500" id="trustMimicryProgress" style="width: 3%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 p-3 bg-green-50 rounded-lg">
                        <p class="text-sm text-green-700" id="fraudInsights">
                            Minimal fraud risk indicators. Consistent behavior patterns and authentic cultural expression suggest genuine profile authenticity.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Detailed Explanations and Tips -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <!-- Why Trustworthy Explanation -->
                <div class="bg-white p-6 rounded-xl">
                    <h4 class="text-lg font-semibold mb-4 text-blue-600">üí° Why This Profile is Trustworthy</h4>
                    <div id="trustworthyExplanation" class="space-y-3 text-sm text-gray-700">
                        <p><strong>Cultural Authenticity:</strong> Strong Kapwa connections (92%) indicate genuine community integration and shared identity values typical of trustworthy Filipino profiles.</p>
                        <p><strong>Behavioral Consistency:</strong> 6+ years of consistent payment history with no velocity anomalies suggests stable and reliable financial behavior.</p>
                        <p><strong>Community Validation:</strong> Vouched by 8 long-term BPI clients and 2 barangay leaders, demonstrating strong community trust and social proof.</p>
                        <p><strong>Regional Alignment:</strong> Cultural patterns authentically match Visayas entrepreneurial profiles, with no signs of cultural mimicry or fraud attempts.</p>
                    </div>
                </div>

                <!-- Improvement Tips -->
                <div class="bg-white p-6 rounded-xl">
                    <h4 class="text-lg font-semibold mb-4 text-green-600">üìà Actionable Improvement Tips</h4>
                    <div id="improvementTips" class="space-y-3 text-sm text-gray-700">
                        <div class="p-3 bg-green-50 rounded-lg">
                            <strong>Cultural Enhancement:</strong>
                            <ul class="mt-1 list-disc list-inside text-xs">
                                <li>Increase Bayanihan participation by joining 2+ community events monthly</li>
                                <li>Strengthen Utang na Loob by consistent gratitude expressions and reciprocity</li>
                            </ul>
                        </div>
                        <div class="p-3 bg-blue-50 rounded-lg">
                            <strong>Network Strengthening:</strong>
                            <ul class="mt-1 list-disc list-inside text-xs">
                                <li>Get vouched by 3+ additional long-term BPI clients in your community</li>
                                <li>Join barangay organizations to increase community leader connections</li>
                            </ul>
                        </div>
                        <div class="p-3 bg-yellow-50 rounded-lg">
                            <strong>Financial Consistency:</strong>
                            <ul class="mt-1 list-disc list-inside text-xs">
                                <li>Maintain current payment patterns for 6+ months for stability bonus</li>
                                <li>Avoid large transaction velocity changes without proper documentation</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Trust Profile Summary Dashboard -->
            <div class="bg-white p-6 rounded-xl">
                <h4 class="text-lg font-semibold mb-4">üìä Trust Profile Summary Dashboard</h4>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-lg text-center">
                        <h5 class="font-semibold text-green-800 mb-2">Key Strengths</h5>
                        <div class="text-sm text-green-700" id="keyStrengths">
                            <div>‚Ä¢ High cultural authenticity</div>
                            <div>‚Ä¢ Consistent payment history</div>
                            <div>‚Ä¢ Strong community vouching</div>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-lg text-center">
                        <h5 class="font-semibold text-blue-800 mb-2">Growth Areas</h5>
                        <div class="text-sm text-blue-700" id="growthAreas">
                            <div>‚Ä¢ Expand community network</div>
                            <div>‚Ä¢ Increase regional activities</div>
                            <div>‚Ä¢ Digital engagement</div>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-red-50 to-red-100 p-4 rounded-lg text-center">
                        <h5 class="font-semibold text-red-800 mb-2">Risk Factors</h5>
                        <div class="text-sm text-red-700" id="riskFactors">
                            <div>‚Ä¢ None identified</div>
                            <div>‚Ä¢ All patterns normal</div>
                            <div>‚Ä¢ Low fraud risk</div>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-gray-50 to-gray-100 p-4 rounded-lg text-center">
                        <h5 class="font-semibold text-gray-800 mb-2">Profile Stats</h5>
                        <div class="text-sm text-gray-700" id="profileStats">
                            <div>BPI History: 6 years</div>
                            <div>Community Vouch: 15</div>
                            <div>Last Updated: Today</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-16">
        <div class="max-w-7xl mx-auto px-6 text-center">
            <div class="flex items-center justify-center space-x-4 mb-4">
                <span class="text-2xl">üß†</span>
                <h3 class="text-xl font-bold">HARAYA ML Algorithm Explorer</h3>
            </div>
            <p class="text-gray-300 mb-4">
                Explore the sophisticated machine learning algorithms powering culturally-intelligent microfinance
            </p>
            <div class="flex justify-center space-x-6 text-sm">
                <button onclick="returnToMainDemo()" class="text-blue-400 hover:text-blue-300">‚Üê Return to Main Demo</button>
                <a href="#" class="text-gray-400 hover:text-gray-300">Documentation</a>
                <a href="#" class="text-gray-400 hover:text-gray-300">API Reference</a>
                <a href="#" class="text-gray-400 hover:text-gray-300">GitHub Repository</a>
            </div>
        </div>
    </footer>

    <!-- Loading Placeholder for Dynamic Content -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg p-8 text-center">
            <div class="loading-animation text-4xl mb-4">üß†</div>
            <h3 class="text-xl font-bold mb-2">Processing Algorithm...</h3>
            <p class="text-gray-600">Please wait while we run the machine learning analysis</p>
        </div>
    </div>

    <!-- JavaScript will be loaded from separate files -->
    <script src="assets/js/ml-core.js"></script>
    <script src="assets/js/data-management.js"></script>
    <script src="assets/js/kmeans-clustering.js"></script>
    <script src="assets/js/neural-network.js?v=20240824-model-comparison"></script>
    <script src="assets/js/trustworthiness-analysis.js"></script>
    <script src="assets/js/evaluation-metrics.js"></script>
    
    <script>
        // Main application initialization
        document.addEventListener('DOMContentLoaded', function() {
            initializeMLExplorer();
            updateActiveAlgorithmsCount();
        });

        // Tab switching functionality
        function switchTab(tabName) {
            // Hide all sections
            const sections = ['data-management', 'kmeans-clustering', 'ml-algorithms', 'trustworthiness-analysis'];
            sections.forEach(section => {
                document.getElementById(`section-${section}`).classList.add('hidden');
                document.getElementById(`tab-${section}`).classList.remove('tab-active');
                document.getElementById(`tab-${section}`).classList.add('tab-inactive');
            });
            
            // Show selected section
            document.getElementById(`section-${tabName}`).classList.remove('hidden');
            document.getElementById(`tab-${tabName}`).classList.remove('tab-inactive');
            document.getElementById(`tab-${tabName}`).classList.add('tab-active');
        }

        // Return to main demo function
        function returnToMainDemo() {
            if (window.opener) {
                window.close();
            } else {
                window.location.href = '../index.html';
            }
        }


        // Update active algorithms counter
        function updateActiveAlgorithmsCount() {
            // Count active data and algorithms
            let count = 0;
            if (window.harayaData && window.harayaData.currentDataset) {
                count += 1; // Data Management active
            }
            // Add other algorithm counts as they're implemented
            count += 3; // K-Means, Neural Network, Cultural Intelligence, Scam Detection (placeholder)
            
            document.getElementById('activeAlgorithmsCount').textContent = count;
        }

        // Data Management functions are now implemented in data-management.js
        // Additional UI helper functions
        function filterData() {
            const regionFilter = document.getElementById('regionFilter').value;
            const trustFilter = document.getElementById('trustFilter').value;
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            
            if (!window.harayaData.currentDataset) return;
            
            let filteredData = window.harayaData.currentDataset;
            
            // Apply region filter
            if (regionFilter !== 'all') {
                filteredData = filteredData.filter(record => 
                    record.region?.toLowerCase().includes(regionFilter)
                );
            }
            
            // Apply trust filter
            if (trustFilter !== 'all') {
                filteredData = filteredData.filter(record => 
                    record.trustworthiness_label === trustFilter
                );
            }
            
            // Apply search filter
            if (searchInput) {
                filteredData = filteredData.filter(record => 
                    Object.values(record).some(value => 
                        String(value).toLowerCase().includes(searchInput)
                    )
                );
            }
            
            // Update the data preview with filtered data
            const originalData = window.harayaData.currentDataset;
            window.harayaData.currentDataset = filteredData;
            window.harayaData.currentPage = 0;
            updateDataPreview();
            updateQuickAnalytics();
            
            // Show filter results
            if (filteredData.length !== originalData.length) {
                showNotification(`Filtered to ${filteredData.length} of ${originalData.length} records`, 'info');
            }
        }
        
        function resetFilters() {
            document.getElementById('regionFilter').value = 'all';
            document.getElementById('trustFilter').value = 'all';
            document.getElementById('searchInput').value = '';
            
            // Reset to original dataset
            if (window.harayaData.filteredData) {
                window.harayaData.currentDataset = window.harayaData.filteredData;
            }
            window.harayaData.currentPage = 0;
            updateDataPreview();
            updateQuickAnalytics();
        }
        
        function updateQuickAnalytics() {
            const data = window.harayaData.currentDataset;
            if (!data || data.length === 0) {
                const elements = ['avgAge', 'avgIncome', 'trustworthyPercent', 'avgDigitalLiteracy'];
                elements.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.textContent = '--';
                });
                return;
            }
            
            // Calculate analytics
            const avgAge = Math.round(data.reduce((sum, d) => sum + (d.age || 0), 0) / data.length);
            const avgIncome = Math.round(data.reduce((sum, d) => sum + (d.monthly_income || 0), 0) / data.length);
            const trustworthyCount = data.filter(d => d.trustworthiness_label === 'trustworthy').length;
            const trustworthyPercent = Math.round((trustworthyCount / data.length) * 100);
            const avgDigitalLit = (data.reduce((sum, d) => sum + (d.digital_literacy_score || 0), 0) / data.length).toFixed(1);
            
            // Update UI
            const updates = {
                'avgAge': avgAge,
                'avgIncome': '‚Ç±' + avgIncome.toLocaleString(),
                'trustworthyPercent': trustworthyPercent + '%',
                'avgDigitalLiteracy': avgDigitalLit
            };
            
            Object.entries(updates).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            });
        }
        
        // Neural Network specific functions
        function resetNeuralNetwork() {
            if (confirm('Are you sure you want to reset the neural network? This will clear all training progress.')) {
                if (window.neuralNetworkState) {
                    window.neuralNetworkState.model?.dispose();
                    window.neuralNetworkState.model = null;
                    window.neuralNetworkState.trainingHistory = {
                        epochs: [],
                        loss: [],
                        accuracy: [],
                        valLoss: [],
                        valAccuracy: []
                    };
                    window.neuralNetworkState.featureImportance = null;
                    window.neuralNetworkState.culturalInsights = [];
                    
                    // Reset UI
                    document.getElementById('trainingAccuracy').textContent = '0%';
                    document.getElementById('trainingLoss').textContent = '0.00';
                    document.getElementById('trainingProgress').style.width = '0%';
                    document.getElementById('culturalInsights').innerHTML = '<div class="text-gray-500 italic">Train the neural network to discover cultural patterns...</div>';
                    
                    // Reset performance metrics
                    ['modelPrecision', 'modelRecall', 'modelF1Score', 'modelParameters'].forEach(id => {
                        const el = document.getElementById(id);
                        if (el) el.textContent = '--';
                    });
                    
                    showNotification('Neural network reset successfully', 'success');
                }
            }
        }
        
        // Setup additional neural network controls
        function setupAdditionalNeuralNetworkControls() {
            // Training epochs slider
            const epochsSlider = document.getElementById('trainingEpochs');
            const epochsValue = document.getElementById('trainingEpochsValue');
            if (epochsSlider && epochsValue) {
                epochsSlider.addEventListener('input', function() {
                    epochsValue.textContent = this.value;
                    if (window.neuralNetworkState) {
                        window.neuralNetworkState.hyperparameters.epochs = parseInt(this.value);
                    }
                });
            }
            
            // Early stopping checkbox
            const earlyStoppingCheckbox = document.getElementById('earlyStopping');
            if (earlyStoppingCheckbox) {
                earlyStoppingCheckbox.addEventListener('change', function() {
                    if (window.neuralNetworkState) {
                        window.neuralNetworkState.hyperparameters.earlyStopping = this.checked;
                    }
                });
            }
            
            // Demo prediction sliders
            const demoInputs = ['demoKapwa', 'demoBayanihan', 'demoIncome', 'demoFamilySize'];
            demoInputs.forEach(id => {
                const input = document.getElementById(id);
                const valueDisplay = document.getElementById(id + 'Value');
                if (input) {
                    input.addEventListener('input', function() {
                        if (valueDisplay && (id.includes('Kapwa') || id.includes('Bayanihan'))) {
                            valueDisplay.textContent = parseFloat(this.value).toFixed(2);
                        }
                        updateLivePrediction();
                    });
                }
            });
        }
        
        // Update live prediction demo
        async function updateLivePrediction() {
            const resultElement = document.getElementById('demoPredictionResult');
            if (!resultElement) return;
            
            if (!window.neuralNetworkState?.model) {
                resultElement.innerHTML = '<span class="text-gray-500">Train model to enable predictions</span>';
                return;
            }
            
            try {
                const persona = {
                    kapwa_score: parseFloat(document.getElementById('demoKapwa')?.value || 0.8),
                    bayanihan_participation: parseFloat(document.getElementById('demoBayanihan')?.value || 0.75),
                    utang_na_loob_integrity: 0.7, // Default
                    community_standing_score: 0.8, // Default
                    monthly_income: parseInt(document.getElementById('demoIncome')?.value || 25000),
                    family_size: parseInt(document.getElementById('demoFamilySize')?.value || 4),
                    digital_literacy_score: 6 // Default
                };
                
                const prediction = await window.predictTrustScore(persona);
                const trustScore = (prediction.trustworthiness_score * 100).toFixed(1);
                const confidence = (prediction.confidence * 100).toFixed(1);
                
                const colorClass = prediction.prediction === 'trustworthy' ? 'text-green-600' : 'text-red-600';
                resultElement.innerHTML = `<span class="${colorClass}">${trustScore}% ${prediction.prediction.toUpperCase()}</span><br><small>Confidence: ${confidence}%</small>`;
                
            } catch (error) {
                resultElement.innerHTML = '<span class="text-gray-500">Prediction error</span>';
            }
        }
        
        // Initialize additional controls when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                setupAdditionalNeuralNetworkControls();
            }, 1000);
        });
        
        // Dataset Integration Functions for K-Means
        function refreshDatasetConnection() {
            const statusIndicator = document.getElementById('datasetStatusIndicator');
            const selector = document.getElementById('kmeansDatasetSelector');
            const recordsDisplay = document.getElementById('kmeansDatasetRecords');
            const sourceDisplay = document.getElementById('kmeansDatasetSource');
            const mappingInfo = document.getElementById('featureMappingInfo');
            
            // Clear existing options
            selector.innerHTML = '<option value="">No dataset loaded</option>';
            
            if (window.harayaData && window.harayaData.currentDataset) {
                // Perform comprehensive data validation
                const validationResult = validateDatasetForKMeans(window.harayaData.currentDataset);
                
                // Update status indicator based on validation
                if (validationResult.isValid) {
                    statusIndicator.className = 'w-3 h-3 bg-green-500 rounded-full';
                } else if (validationResult.warnings.length > 0) {
                    statusIndicator.className = 'w-3 h-3 bg-yellow-500 rounded-full';
                } else {
                    statusIndicator.className = 'w-3 h-3 bg-red-500 rounded-full';
                }
                
                // Add dataset option
                const option = document.createElement('option');
                option.value = 'current';
                option.textContent = `Current Dataset (${window.harayaData.currentDataset.length} records)`;
                option.selected = true;
                selector.appendChild(option);
                
                // Update displays
                recordsDisplay.textContent = window.harayaData.currentDataset.length.toLocaleString();
                sourceDisplay.textContent = 'Data Management Tab';
                
                // Show mapping info
                mappingInfo.classList.remove('hidden');
                
                // Show validation results
                if (validationResult.isValid) {
                    showNotification('Dataset is fully compatible and ready for K-Means clustering!', 'success');
                } else if (validationResult.warnings.length > 0) {
                    showNotification(`Dataset loaded with warnings: ${validationResult.warnings[0]}`, 'warning');
                } else {
                    showNotification(`Dataset compatibility issues: ${validationResult.errors[0]}`, 'error');
                }
                
                // Update data quality indicators
                updateKmeansDatasetInfo();
            } else {
                // No dataset available
                statusIndicator.className = 'w-3 h-3 bg-red-500 rounded-full';
                recordsDisplay.textContent = '--';
                sourceDisplay.textContent = 'No data loaded';
                mappingInfo.classList.add('hidden');
                
                showNotification('No dataset found. Please load data in the Data Management tab first.', 'warning');
            }
        }
        
        // Comprehensive data validation for K-Means compatibility
        function validateDatasetForKMeans(dataset) {
            const result = {
                isValid: false,
                warnings: [],
                errors: [],
                recommendations: []
            };
            
            if (!dataset || dataset.length === 0) {
                result.errors.push('Dataset is empty');
                return result;
            }
            
            // Check minimum record count
            if (dataset.length < 10) {
                result.warnings.push(`Only ${dataset.length} records available. Minimum 10 recommended for clustering.`);
            } else if (dataset.length < 50) {
                result.warnings.push(`${dataset.length} records available. 50+ recommended for optimal clustering results.`);
            }
            
            // Check for required fields
            const requiredFields = ['community_standing_score', 'location_stability_score', 'bill_payment_consistency'];
            const missingFields = requiredFields.filter(field => !dataset[0].hasOwnProperty(field));
            
            if (missingFields.length > 0) {
                result.errors.push(`Missing required fields: ${missingFields.join(', ')}`);
                result.recommendations.push('Ensure your dataset includes community standing, location stability, and bill payment consistency scores');
            }
            
            // Check data quality for each field
            requiredFields.forEach(field => {
                if (dataset[0].hasOwnProperty(field)) {
                    const validValues = dataset.filter(record => {
                        const value = record[field];
                        return value !== null && value !== undefined && !isNaN(value) && value >= 0 && value <= 1;
                    });
                    
                    const completeness = (validValues.length / dataset.length) * 100;
                    
                    if (completeness < 50) {
                        result.errors.push(`Field '${field}' has only ${completeness.toFixed(1)}% valid data`);
                    } else if (completeness < 80) {
                        result.warnings.push(`Field '${field}' has ${completeness.toFixed(1)}% data completeness`);
                    }
                }
            });
            
            // Check for data diversity (avoid clustering identical records)
            const uniqueRecords = new Set(dataset.map(record => 
                requiredFields.map(field => record[field]).join('|')
            ));
            
            const uniqueness = (uniqueRecords.size / dataset.length) * 100;
            if (uniqueness < 30) {
                result.warnings.push(`Low data diversity (${uniqueness.toFixed(1)}% unique combinations). Clustering may not be meaningful.`);
            }
            
            // Determine overall validity
            result.isValid = result.errors.length === 0;
            
            // Add recommendations based on analysis
            if (result.isValid) {
                if (dataset.length >= 100) {
                    result.recommendations.push('Excellent dataset size for robust clustering analysis');
                }
                if (uniqueness > 70) {
                    result.recommendations.push('High data diversity will enable meaningful cluster discovery');
                }
            }
            
            return result;
        }
        
        function selectKmeansDataset() {
            const selector = document.getElementById('kmeansDatasetSelector');
            const selectedValue = selector.value;
            
            if (selectedValue === 'current') {
                // Use current dataset from data management
                if (window.harayaData && window.harayaData.currentDataset) {
                    showNotification(`Using dataset with ${window.harayaData.currentDataset.length} records for K-Means`, 'info');
                    updateKmeansDatasetInfo();
                }
            } else {
                // No dataset selected
                showNotification('Please select a dataset to use for K-Means clustering', 'warning');
            }
        }
        
        function updateKmeansDatasetInfo() {
            const data = window.harayaData.currentDataset;
            if (!data || data.length === 0) return;
            
            // Check data compatibility and update data quality indicators
            const fieldMappings = [
                { csvField: 'community_standing_score', element: 'kapwaDataQuality', name: 'Kapwa' },
                { csvField: 'location_stability_score', element: 'bayanihanDataQuality', name: 'Bayanihan' },
                { csvField: 'bill_payment_consistency', element: 'utangDataQuality', name: 'Utang na Loob' }
            ];
            
            let allFieldsAvailable = true;
            let dataCompleteness = [];
            
            fieldMappings.forEach(mapping => {
                const element = document.getElementById(mapping.element);
                if (element) {
                    if (data[0].hasOwnProperty(mapping.csvField)) {
                        // Check data completeness
                        const validValues = data.filter(record => 
                            record[mapping.csvField] !== null && 
                            record[mapping.csvField] !== undefined && 
                            !isNaN(record[mapping.csvField])
                        ).length;
                        const completeness = ((validValues / data.length) * 100).toFixed(1);
                        
                        element.innerHTML = `‚úì Available (${completeness}%)`;
                        element.className = completeness > 90 ? 'text-green-600 text-xs' : 'text-yellow-600 text-xs';
                        
                        dataCompleteness.push(`${mapping.name}: ${completeness}%`);
                    } else {
                        element.innerHTML = '‚úó Missing';
                        element.className = 'text-red-600 text-xs';
                        allFieldsAvailable = false;
                        dataCompleteness.push(`${mapping.name}: Not Available`);
                    }
                }
            });
            
            // Update data completeness info
            const completenessInfo = document.getElementById('dataCompletenessInfo');
            if (completenessInfo) {
                completenessInfo.innerHTML = dataCompleteness.join(' ‚Ä¢ ');
            }
            
            if (allFieldsAvailable) {
                showNotification('Dataset is fully compatible with K-Means clustering!', 'success');
            } else {
                showNotification('Warning: Some required fields are missing for optimal clustering', 'warning');
            }
        }
        
        function toggleDetailedMapping() {
            const basicView = document.getElementById('basicMappingView');
            const detailedView = document.getElementById('detailedMappingView');
            const toggleButton = event.target;
            
            if (detailedView.classList.contains('hidden')) {
                detailedView.classList.remove('hidden');
                basicView.classList.add('hidden');
                toggleButton.textContent = 'Show Basic';
                
                // Update data completeness when showing detailed view
                updateKmeansDatasetInfo();
            } else {
                detailedView.classList.add('hidden');
                basicView.classList.remove('hidden');
                toggleButton.textContent = 'Show Details';
            }
        }
        
        // Data synchronization function to ensure both data stores are in sync
        function syncDataBetweenModules() {
            if (window.harayaData && window.harayaData.currentDataset && window.harayaData.currentDataset.length > 0) {
                // Ensure mlCore.sharedData is populated
                if (typeof mlCore !== 'undefined') {
                    mlCore.sharedData = window.harayaData.currentDataset;
                    mlCore.status.dataLoaded = true;
                    console.log('Data sync: Synchronized', window.harayaData.currentDataset.length, 'records to mlCore.sharedData');
                }
                return true;
            }
            return false;
        }
        
        // Auto-refresh dataset connection when data is loaded
        function notifyKmeansDatasetChange() {
            // This function will be called from data management when data changes
            setTimeout(() => {
                syncDataBetweenModules(); // Ensure data synchronization
                refreshDatasetConnection();
                showMLReadyStatus();
            }, 500);
        }
        
        // Show ML Ready Status in Data Management section
        function showMLReadyStatus() {
            const mlReadyStatus = document.getElementById('mlReadyStatus');
            const readyRecordCount = document.getElementById('readyRecordCount');
            
            if (window.harayaData && window.harayaData.currentDataset && window.harayaData.currentDataset.length > 0) {
                readyRecordCount.textContent = window.harayaData.currentDataset.length.toLocaleString();
                mlReadyStatus.classList.remove('hidden');
            } else {
                mlReadyStatus.classList.add('hidden');
            }
        }
        
        // Enhanced initialization to connect data management and K-Means
        function initializeMLExplorer() {
            console.log('HARAYA ML Algorithm Explorer initialized');
            
            // Set up event listeners for data changes
            const originalUpdateDataPreview = window.updateDataPreview;
            if (typeof originalUpdateDataPreview === 'function') {
                window.updateDataPreview = function() {
                    originalUpdateDataPreview.apply(this, arguments);
                    // Notify K-Means when data updates
                    notifyKmeansDatasetChange();
                };
            }
            
            // Set up observers for data loading from data management module
            const checkForDataUpdates = () => {
                if (window.harayaData && window.harayaData.currentDataset) {
                    notifyKmeansDatasetChange();
                    clearInterval(dataCheckInterval); // Stop checking once data is found
                }
            };
            
            // Check for data periodically during initialization
            const dataCheckInterval = setInterval(checkForDataUpdates, 1000);
            
            // The default dataset will be loaded by the data-management module
            // Update the active algorithms count and analytics
            setTimeout(() => {
                syncDataBetweenModules(); // Ensure data synchronization
                updateActiveAlgorithmsCount();
                if (typeof updateQuickAnalytics === 'function') {
                    updateQuickAnalytics();
                }
                refreshDatasetConnection(); // Initialize dataset connection status
                showMLReadyStatus(); // Show ML ready status if data is available
                
                // Clear the interval after initialization
                clearInterval(dataCheckInterval);
            }, 2000);
        }
        
        // ML Algorithms Dashboard Functions
        function refreshMLDatasetConnection() {
            // Use the existing mlCore functionality
            if (mlCore && mlCore.sharedData && mlCore.sharedData.length > 0) {
                document.getElementById('mlDatasetStatusIndicator').className = 'w-3 h-3 bg-green-400 rounded-full';
                document.getElementById('mlDatasetRecords').textContent = mlCore.sharedData.length.toLocaleString();
                
                // Calculate label distribution
                const trustworthyCount = mlCore.sharedData.filter(row => 
                    row.trustworthiness_label === 'trustworthy' || row.is_legitimate === true
                ).length;
                const untrustworthy = mlCore.sharedData.length - trustworthyCount;
                document.getElementById('mlLabelDistribution').textContent = 
                    `${trustworthyCount} trustworthy, ${untrustworthy} untrustworthy`;
                
                // Update dataset selector
                const selector = document.getElementById('mlDatasetSelector');
                selector.innerHTML = '<option value="current">Current Dataset (Active)</option>';
            } else {
                document.getElementById('mlDatasetStatusIndicator').className = 'w-3 h-3 bg-red-400 rounded-full';
                document.getElementById('mlDatasetRecords').textContent = '--';
                document.getElementById('mlLabelDistribution').textContent = '--';
                
                const selector = document.getElementById('mlDatasetSelector');
                selector.innerHTML = '<option value="">No dataset loaded</option>';
            }
        }

        function selectMLDataset() {
            // Dataset selection logic - for now, just refresh
            refreshMLDatasetConnection();
        }

        function clearMLDebugConsole() {
            const console = document.getElementById('mlDebugConsole');
            console.innerHTML = '<div>ü§ñ ML Debug Console Cleared</div>';
        }

        function exportMLDebugLog() {
            const consoleContent = document.getElementById('mlDebugConsole').textContent;
            const blob = new Blob([consoleContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ml-debug-log-${new Date().toISOString().slice(0,19).replace(/:/g, '-')}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Override debugToUI to also log to ML console
        const originalDebugToUI = window.debugToUI;
        window.debugToUI = function(message) {
            // Call original function if it exists
            if (originalDebugToUI) {
                originalDebugToUI(message);
            }
            
            // Also log to ML console
            const mlConsole = document.getElementById('mlDebugConsole');
            if (mlConsole) {
                const timestamp = new Date().toLocaleTimeString();
                const div = document.createElement('div');
                div.textContent = `[${timestamp}] ${message}`;
                mlConsole.appendChild(div);
                mlConsole.scrollTop = mlConsole.scrollHeight;
            }
        };

        // Batch training functions
        async function trainAllAdvancedModels() {
            debugToUI('üöÄ Starting batch training of all advanced ML models...');
            
            try {
                await trainSemiSupervisedLearning();
                await new Promise(resolve => setTimeout(resolve, 1000)); // Small delay between models
                
                await trainSelfSupervisedLearning();
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                await trainReinforcementLearning();
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                await trainAdvancedEnsemble();
                
                debugToUI('‚úÖ All advanced models training completed!');
                showNotification('All advanced ML models have been trained successfully!', 'success');
            } catch (error) {
                debugToUI(`‚ùå Batch training failed: ${error.message}`);
                showNotification('Batch training failed. Check debug console for details.', 'error');
            }
        }

        async function trainAllTraditionalModels() {
            debugToUI('üìä Starting batch training of traditional ML models...');
            
            try {
                await trainLinearRegression();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await trainSupportVectorRegression();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await trainRandomForestRegression();
                
                debugToUI('‚úÖ All traditional models training completed!');
                showNotification('All traditional ML models have been trained successfully!', 'success');
            } catch (error) {
                debugToUI(`‚ùå Traditional models batch training failed: ${error.message}`);
                showNotification('Traditional models training failed. Check debug console for details.', 'error');
            }
        }

        // Initialize ML algorithms dashboard when tab is opened
        function initializeMLAlgorithmsDashboard() {
            refreshMLDatasetConnection();
        }

        // All functions are now implemented in their respective modules
        // K-means: runKMeansClustering() in kmeans-clustering.js
        // ML Algorithms: Various advanced ML algorithms in neural-network.js
        // Cultural Intelligence: updateCulturalWeights() in cultural-intelligence.js
        // Scam Detection: analyzeScamRisk() in scam-detection.js

        // Train-Val-Test Split Visualization Functions
        function updateSplitPreview() {
            const trainRatio = parseInt(document.getElementById('trainRatioSlider').value);
            const valRatio = parseInt(document.getElementById('valRatioSlider').value);
            const testRatio = 100 - trainRatio - valRatio;
            
            // Update display values
            document.getElementById('trainRatioValue').textContent = trainRatio + '%';
            document.getElementById('valRatioValue').textContent = valRatio + '%';
            document.getElementById('testRatioValue').textContent = testRatio + '%';
            
            // Validate ratios
            if (testRatio < 5) {
                document.getElementById('testRatioValue').parentNode.classList.add('text-red-600');
                document.getElementById('testRatioValue').parentNode.classList.remove('text-gray-600');
            } else {
                document.getElementById('testRatioValue').parentNode.classList.remove('text-red-600');
                document.getElementById('testRatioValue').parentNode.classList.add('text-gray-600');
            }
            
            // Update legend
            const legend = document.querySelector('.flex.items-center.space-x-2');
            if (legend) {
                legend.innerHTML = `
                    <span class="text-xs text-orange-600">${trainRatio}% Train</span>
                    <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                    <span class="text-xs text-orange-600">${valRatio}% Val</span>
                    <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                    <span class="text-xs text-orange-600">${testRatio}% Test</span>
                    <span class="w-2 h-2 bg-red-500 rounded-full"></span>
                `;
            }
        }

        function updateSplitVisualization(algorithm, splitInfo) {
            const algorithmMap = {
                'Linear Regression': 'lr',
                'Support Vector Regression': 'svr',
                'Random Forest': 'rf',
                'Advanced Ensemble': 'ensemble'
            };
            
            const algorithmId = algorithmMap[algorithm];
            if (!algorithmId) return;
            
            // Update split sizes
            if (splitInfo && splitInfo.train) {
                document.getElementById(`${algorithmId}-train-size`).textContent = splitInfo.train.size.toLocaleString();
                document.getElementById(`${algorithmId}-val-size`).textContent = splitInfo.validation.size.toLocaleString();
                document.getElementById(`${algorithmId}-test-size`).textContent = splitInfo.test.size.toLocaleString();
                
                // Update timestamp
                const now = new Date();
                document.getElementById(`${algorithmId}-split-time`).textContent = 
                    now.getHours().toString().padStart(2, '0') + ':' + 
                    now.getMinutes().toString().padStart(2, '0') + ':' + 
                    now.getSeconds().toString().padStart(2, '0');
                    
                // Update split ratios if different from default
                const actualTrainRatio = Math.round(splitInfo.splitInfo.trainRatio * 100);
                const actualValRatio = Math.round(splitInfo.splitInfo.valRatio * 100);
                const actualTestRatio = Math.round(splitInfo.splitInfo.testRatio * 100);
                
                document.getElementById(`${algorithmId}-split-type`).textContent = 
                    `${actualTrainRatio}-${actualValRatio}-${actualTestRatio}`;
            }
        }

        // Initialize split visualization when page loads
        document.addEventListener('DOMContentLoaded', function() {
            updateSplitPreview();
        });
    </script>
</body>
</html>